<html>
    <bvody>
        <script src="https://cdn.sheetjs.com/xlsx-0.20.2/package/dist/xlsx.full.min.js"></script>
        <div style="font-size:20px; padding:5px"><h1>DDI Profile Validator</h1>
            <h2>Input DDI</h2>
            <input id="input" type="file"/>
            <div style="padding:5px" id="qv"></div>
            <div style="padding:5px" id="tv"></div>
            <div style="padding:5px" id="tq"></div>
            <div style="padding:5px" id="dv"></div>
            
            <h2>DDI profile</h2>
            Change DDI Profile used for validation (if nothing selected, ddi3.2 profile is used)
        </div>
            <div id="validatorOutput"></div>
            <input id="profile" type="file"/>
            <input id="validateButton" type="button" value="Validate"/>

            <script>

const profile2="<?xml version='1.0' encoding='UTF-8'?><?xml-stylesheet href='DDI32Profile2html.xslt' type='text/xsl'?><pr:DDIProfile xmlns:pr='ddi:ddiprofile:3_2' xmlns:r='ddi:reusable:3_2' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='ddi:instance:3_2 http://www.ddialliance.org/Specification/DDI-Lifecycle/3.2/XMLSchema/instance.xsd'>  <r:URN>urn:ddi:xx.agencyid:objectid:1</r:URN>  <pr:DDIProfileName>    <r:String>CLOSER Dataset DDI-Lifecycle 3.2 Profile</r:String>  </pr:DDIProfileName>  <r:Label>    <r:Content>CLOSER DDI Lifecycle 3.2 Profile for a Dataset</r:Content>  </r:Label>  <r:Description>    <r:Content>Describes DDI Lifecycle 3.2 items that are expected for ingest into CLOSER Discovery</r:Content>  </r:Description>  <pr:ApplicationOfProfile>Allows checking of inputs to ensure that all expeced content has been generated by the SPSS or Stata to DDI conversion tools. </pr:ApplicationOfProfile>  <r:Purpose>    <r:Content>Allows providers and CLOSER to assess the content of datasets generated for ingest into CLOSER Discovery</r:Content>  </r:Purpose>  <pr:XPathVersion>1.0</pr:XPathVersion>  <pr:DDINamespace>3.2</pr:DDINamespace>  <pr:XMLPrefixMap>    <pr:XMLPrefix/>    <pr:XMLNamespace>ddi:instance:3_2</pr:XMLNamespace>  </pr:XMLPrefixMap>  <pr:XMLPrefixMap>    <pr:XMLPrefix>r</pr:XMLPrefix>    <pr:XMLNamespace>ddi:reusable:3_2</pr:XMLNamespace>  </pr:XMLPrefixMap>  <pr:XMLPrefixMap>    <pr:XMLPrefix>g</pr:XMLPrefix>    <pr:XMLNamespace>ddi:group:3_2</pr:XMLNamespace>  </pr:XMLPrefixMap>  <pr:XMLPrefixMap>    <pr:XMLPrefix>ddi</pr:XMLPrefix>    <pr:XMLNamespace>ddi:logicalproduct:3_2</pr:XMLNamespace>  </pr:XMLPrefixMap>  <pr:XMLPrefixMap>    <pr:XMLPrefix>p</pr:XMLPrefix>    <pr:XMLNamespace>ddi:physicaldataproduct:3_2</pr:XMLNamespace>  </pr:XMLPrefixMap>  <pr:XMLPrefixMap>    <pr:XMLPrefix>ddi1</pr:XMLPrefix>    <pr:XMLNamespace>ddi:physicaldataproduct_proprietary:3_2</pr:XMLNamespace>  </pr:XMLPrefixMap>  <pr:XMLPrefixMap>    <pr:XMLPrefix>pi</pr:XMLPrefix>    <pr:XMLNamespace>ddi:physicalinstance:3_2</pr:XMLNamespace>  </pr:XMLPrefixMap>  <!-- Element 'Used': Adjust the attributes isRequired and fixedValue (currently set to default values). Additionally, the attributes 'defaultValue' and 'limitMaxOccurs' are possible.-->  <pr:Used xpath='/DDIInstance' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/r:URN' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/r:Citation' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/r:Citation/r:Title' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/r:Citation/r:Title/r:String' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/r:Citation/r:AlternateTitle' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:LogicalProduct' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:LogicalProduct/ddi:LogicalProductName' fixedValue='false' isRequired='false'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:LogicalProduct/r:Label' fixedValue='false' isRequired='false'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:LogicalProduct/r:Label/r:Content' fixedValue='false' isRequired='false'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:LogicalProduct/ddi:DataRelationship' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:LogicalProduct/ddi:DataRelationship/ddi:DataRelationshipName' fixedValue='false' isRequired='false'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:LogicalProduct/ddi:DataRelationship/ddi:LogicalRecord' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:LogicalProduct/ddi:DataRelationship/ddi:LogicalRecord/ddi:LogicalRecordName' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:LogicalProduct/ddi:DataRelationship/ddi:LogicalRecord/ddi:VariablesInRecord' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:LogicalProduct/ddi:DataRelationship/ddi:LogicalRecord/ddi:VariablesInRecord/ddi:VariableUsedReference' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:LogicalProduct/ddi:DataRelationship/ddi:LogicalRecord/ddi:VariablesInRecord/ddi:VariableUsedReference/r:TypeOfObject' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:LogicalProduct/r:CategorySchemeReference' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:LogicalProduct/r:CodeListSchemeReference' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:LogicalProduct/r:VariableSchemeReference' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/p:PhysicalDataProduct' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/p:PhysicalDataProduct/p:PhysicalDataProductName' fixedValue='false' isRequired='false'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/p:PhysicalDataProduct/p:PhysicalStructureScheme' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/p:PhysicalDataProduct/p:PhysicalStructureScheme/p:PhysicalStructure' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/p:PhysicalDataProduct/p:PhysicalStructureScheme/p:PhysicalStructure/r:BasedOnObject' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/p:PhysicalDataProduct/p:PhysicalStructureScheme/p:PhysicalStructure/r:BasedOnObject/r:BasedOnReference' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/p:PhysicalDataProduct/p:PhysicalStructureScheme/p:PhysicalStructure/p:FileFormat' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/p:PhysicalDataProduct/p:PhysicalStructureScheme/p:PhysicalStructure/p:GrossRecordStructure' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/p:PhysicalDataProduct/p:PhysicalStructureScheme/p:PhysicalStructure/p:GrossRecordStructure/p:LogicalRecordReference' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/p:PhysicalDataProduct/p:PhysicalStructureScheme/p:PhysicalStructure/p:GrossRecordStructure/p:PhysicalRecordSegment' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/p:PhysicalDataProduct/p:PhysicalStructureScheme/p:PhysicalStructure/p:GrossRecordStructure/p:PhysicalRecordSegment/r:Agency' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/p:PhysicalDataProduct/p:PhysicalStructureScheme/p:PhysicalStructure/p:GrossRecordStructure/p:PhysicalRecordSegment/r:ID' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/p:PhysicalDataProduct/p:PhysicalStructureScheme/p:PhysicalStructure/p:GrossRecordStructure/p:PhysicalRecordSegment/r:Version' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/p:PhysicalDataProduct/p:RecordLayoutScheme' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/p:PhysicalDataProduct/p:RecordLayoutScheme/ddi1:RecordLayout' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/p:PhysicalDataProduct/p:RecordLayoutScheme/ddi1:RecordLayout/p:PhysicalStructureLinkReference' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/p:PhysicalDataProduct/p:RecordLayoutScheme/ddi1:RecordLayout/p:PhysicalStructureLinkReference/p:PhysicalRecordSegmentUsed' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/p:PhysicalDataProduct/p:RecordLayoutScheme/ddi1:RecordLayout/ddi1:SystemSoftware' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/p:PhysicalDataProduct/p:RecordLayoutScheme/ddi1:RecordLayout/ddi1:SystemSoftware/r:SoftwareName' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/p:PhysicalDataProduct/p:RecordLayoutScheme/ddi1:RecordLayout/ddi1:SystemSoftware/r:Description' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/p:PhysicalDataProduct/p:RecordLayoutScheme/ddi1:RecordLayout/r:DefaultVariableSchemeReference' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/p:PhysicalDataProduct/p:RecordLayoutScheme/ddi1:RecordLayout/r:ProprietaryInfo' fixedValue='false' isRequired='false'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/p:PhysicalDataProduct/p:RecordLayoutScheme/ddi1:RecordLayout/r:ProprietaryInfo/r:ProprietaryProperty' fixedValue='false' isRequired='false'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/p:PhysicalDataProduct/p:RecordLayoutScheme/ddi1:RecordLayout/r:ProprietaryInfo/r:ProprietaryProperty/r:AttributeKey' fixedValue='false' isRequired='false'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/p:PhysicalDataProduct/p:RecordLayoutScheme/ddi1:RecordLayout/r:ProprietaryInfo/r:ProprietaryProperty/r:AttributeValue' fixedValue='false' isRequired='false'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/p:PhysicalDataProduct/p:RecordLayoutScheme/ddi1:RecordLayout/ddi1:DataItem' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/p:PhysicalDataProduct/p:RecordLayoutScheme/ddi1:RecordLayout/ddi1:DataItem/r:VariableReference' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/p:PhysicalDataProduct/p:RecordLayoutScheme/ddi1:RecordLayout/ddi1:DataItem/ddi1:ProprietaryDataType' fixedValue='false' isRequired='false'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/p:PhysicalDataProduct/p:RecordLayoutScheme/ddi1:RecordLayout/ddi1:DataItem/ddi1:ProprietaryOutputFormat' fixedValue='false' isRequired='false'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/pi:PhysicalInstance' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/pi:PhysicalInstance/r:RecordLayoutReference' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/pi:PhysicalInstance/pi:DataFileIdentification' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/pi:PhysicalInstance/pi:DataFileIdentification/pi:DataFileURI' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/pi:PhysicalInstance/pi:GrossFileStructure' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/pi:PhysicalInstance/pi:GrossFileStructure/pi:CreationSoftware' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/pi:PhysicalInstance/pi:GrossFileStructure/pi:CaseQuantity' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/pi:PhysicalInstance/pi:StatisticalSummary' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/pi:PhysicalInstance/pi:StatisticalSummary/pi:VariableStatistics' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/pi:PhysicalInstance/pi:StatisticalSummary/pi:VariableStatistics/pi:SummaryStatistic' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/pi:PhysicalInstance/pi:StatisticalSummary/pi:VariableStatistics/pi:SummaryStatistic/pi:TypeOfSummaryStatistic' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/pi:PhysicalInstance/pi:StatisticalSummary/pi:VariableStatistics/pi:SummaryStatistic/pi:Statistic' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/pi:PhysicalInstance/pi:StatisticalSummary/pi:VariableStatistics/pi:UnfilteredCategoryStatistics' fixedValue='false' isRequired='false'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/pi:PhysicalInstance/pi:StatisticalSummary/pi:VariableStatistics/pi:UnfilteredCategoryStatistics/pi:VariableCategory' fixedValue='false' isRequired='false'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/pi:PhysicalInstance/pi:StatisticalSummary/pi:VariableStatistics/pi:UnfilteredCategoryStatistics/pi:VariableCategory/pi:CategoryValue' fixedValue='false' isRequired='false'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/pi:PhysicalInstance/pi:StatisticalSummary/pi:VariableStatistics/pi:UnfilteredCategoryStatistics/pi:VariableCategory/pi:CategoryValue/r:Value' fixedValue='false' isRequired='false'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/pi:PhysicalInstance/pi:StatisticalSummary/pi:VariableStatistics/pi:UnfilteredCategoryStatistics/pi:VariableCategory/pi:CategoryStatistic' fixedValue='false' isRequired='false'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/pi:PhysicalInstance/pi:StatisticalSummary/pi:VariableStatistics/pi:UnfilteredCategoryStatistics/pi:VariableCategory/pi:CategoryStatistic/pi:TypeOfCategoryStatistic' fixedValue='Minimum' isRequired='false'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/pi:PhysicalInstance/pi:StatisticalSummary/pi:VariableStatistics/pi:UnfilteredCategoryStatistics/pi:VariableCategory/pi:CategoryStatistic/pi:TypeOfCategoryStatistic' fixedValue='Maximum' isRequired='false'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/pi:PhysicalInstance/pi:StatisticalSummary/pi:VariableStatistics/pi:UnfilteredCategoryStatistics/pi:VariableCategory/pi:CategoryStatistic/pi:TypeOfCategoryStatistic' fixedValue='Mean' isRequired='false'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/pi:PhysicalInstance/pi:StatisticalSummary/pi:VariableStatistics/pi:UnfilteredCategoryStatistics/pi:VariableCategory/pi:CategoryStatistic/pi:TypeOfCategoryStatistic' fixedValue='ValidCases' isRequired='false'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/pi:PhysicalInstance/pi:StatisticalSummary/pi:VariableStatistics/pi:UnfilteredCategoryStatistics/pi:VariableCategory/pi:CategoryStatistic/pi:TypeOfCategoryStatistic' fixedValue='InvalidCases' isRequired='false'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/pi:PhysicalInstance/pi:StatisticalSummary/pi:VariableStatistics/pi:UnfilteredCategoryStatistics/pi:VariableCategory/pi:CategoryStatistic/pi:TypeOfCategoryStatistic' fixedValue='Mode' isRequired='false'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/pi:PhysicalInstance/pi:StatisticalSummary/pi:VariableStatistics/pi:UnfilteredCategoryStatistics/pi:VariableCategory/pi:CategoryStatistic/pi:TypeOfCategoryStatistic' fixedValue='Frequency' isRequired='false'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/pi:PhysicalInstance/pi:StatisticalSummary/pi:VariableStatistics/pi:UnfilteredCategoryStatistics/pi:VariableCategory/pi:CategoryStatistic/pi:TypeOfCategoryStatistic' fixedValue='InvalidCases' isRequired='false'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:CategoryScheme' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:CategoryScheme/ddi:CategorySchemeName' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:CategoryScheme/ddi:Category' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:CodeListScheme' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:CodeListScheme/ddi:CodeList' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:CodeListScheme/ddi:CodeList/ddi:CodeListName' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:CodeListScheme/ddi:CodeList/ddi:Code' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:CodeListScheme/ddi:CodeList/ddi:Code/r:CategoryReference' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:VariableScheme' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:VariableScheme/ddi:VariableSchemeName' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:VariableScheme/ddi:Variable' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:VariableScheme/ddi:Variable/ddi:VariableName' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:VariableScheme/ddi:Variable/ddi:VariableRepresentation' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:VariableScheme/ddi:Variable/ddi:VariableRepresentation/r:TextRepresentation' fixedValue='false' isRequired='false'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:VariableScheme/ddi:Variable/ddi:VariableRepresentation/r:TextRepresentation/r:RecommendedDataType' fixedValue='false' isRequired='false'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:VariableScheme/ddi:Variable/ddi:VariableRepresentation/r:TextRepresentation/r:GenericOutputFormat' fixedValue='false' isRequired='false'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:VariableScheme/ddi:Variable/ddi:VariableRepresentation/r:CodeRepresentation' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:VariableScheme/ddi:Variable/ddi:VariableRepresentation/r:CodeRepresentation/r:CodeListReference' fixedValue='false' isRequired='true'/>  <pr:Used xpath='/DDIInstance/g:ResourcePackage/ddi:VariableScheme/ddi:Variable/ddi:VariableRepresentation/r:NumericRepresentation' fixedValue='false' isRequired='false'/></pr:DDIProfile>"   


async function executePostRequestWithoutToken(url, requestBody) {

const options = {
  method: 'POST',
  body: JSON.stringify(requestBody),
  headers: { 'Content-Type': 'application/json' }

}

try {
  const res = await fetch(url, options);
  return await res;
} catch (error) {
  console.log(`Error: API call to ${url} failed! ${error.message}, ${error.cause}, ${error.cause.code}`)
}

}
  
            function createBlobURL(columns) {

                var file2 = ""
            for (let i = 0; i < columns[0].length; i++) {
            
                const fileEntry = columns.map(column => column[i])

                console.log(fileEntry)
        
            if (!(fileEntry.includes("NA") || fileEntry.includes("Derived")))
                file2 = file2 +fileEntry.join("\t") +"\n"

      }

      var formBlob = new Blob([file2], { type: 'text/plain' });

      const link2 = window.URL.createObjectURL(formBlob);

      return link2

            }
//I NEED TO WRITE CODE THAT WILL ACCEPT A PROFILE AS IN TEST.TXT, AND CONVERT 
// TO public/DDIprofile.txt
            const inputElement = document.getElementById("input");

            const profileElement = document.getElementById("profile");

            const buttonElement = document.getElementById("validateButton");

            profileElement.addEventListener("change", handleProfile, false);

                inputElement.addEventListener("change", handleFiles, false);

                buttonElement.addEventListener("click", () => validateDdi(), false)
                
                
                var jsonBodyTemplate = {
  "document": {
    "content": "string"
  },
  "profile": {
    "content": profile2
  },
  "validationGateName": "BASIC",
  
}

function handleProfile() {
                    const fileList = this.files;
                    console.log("UPLOADED")
                    console.log(fileList[0])
                    const reader = new FileReader()
                    reader.readAsArrayBuffer(fileList[0])
                    reader.onload = (function (event) {
                        console.log(new TextDecoder().decode(reader.result))
                        //jsonBodyTemplate.document.content=new TextDecoder().decode(reader.result)
                        jsonBodyTemplate.profile.content=new TextDecoder().decode(reader.result)
                        //parsedJson = (JSON.parse(new TextDecoder().decode(reader.result)));
                        parsedJson=jsonBodyTemplate
                        console.log(parsedJson)
                        var jsonBody = parsedJson
                    })
                }

                function handleFiles() {
                    const fileList = this.files;
                    console.log("UPLOADED")
                    console.log(fileList[0])
                    const reader = new FileReader()
                    reader.readAsArrayBuffer(fileList[0])
                    reader.onload = (function (event) {
                        console.log(new TextDecoder().decode(reader.result))
                        //jsonBodyTemplate.document.content=new TextDecoder().decode(reader.result)
                        jsonBodyTemplate.document.content=new TextDecoder().decode(reader.result)
                        //parsedJson = (JSON.parse(new TextDecoder().decode(reader.result)));
                        parsedJson=jsonBodyTemplate
                        console.log(parsedJson)
                        var jsonBody = parsedJson
                    })
                }

    function validateDdi() {
                    console.log(jsonBodyTemplate)
                    executePostRequestWithoutToken("https://cmv.cessda.eu/api/V0/Validation",                    
                    jsonBodyTemplate
                ).then(data => {
                    return data.json()
}
).then(data2  => 
        {
            console.log(data2)
        var output = "<div>"    
        output = output + data2.ConstraintViolation.map(x => "<div>" + x.message + "</div>").join("")
        output = output + "</div>"
        document.getElementById("validatorOutput").innerHTML = output
        }
        
    )
                }
                    
                            
                            </script>
                

    </body>
</html> 